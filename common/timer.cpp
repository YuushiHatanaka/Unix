//-----------------------------------------------------------------------------
// timerモジュール
//-----------------------------------------------------------------------------

//-----------------------------------------------------------------------------
// インクルードファイル
//-----------------------------------------------------------------------------
#include "timer.hpp"

//-----------------------------------------------------------------------------
// コンストラクタ
//-----------------------------------------------------------------------------
timer::timer()
{
    // 初期化
    memset( &(timer::m_start), 0x00, sizeof(timer::m_start) );
    memset( &(timer::m_stoped), 0x00, sizeof(timer::m_stoped) );
}

//-----------------------------------------------------------------------------
// デストラクタ
//-----------------------------------------------------------------------------
timer::~timer()
{
}

//-----------------------------------------------------------------------------
// 開始
//-----------------------------------------------------------------------------
void timer::start()
{
    // 現在日時取得
    gettimeofday( &(timer::m_start), NULL );
}

//-----------------------------------------------------------------------------
// 停止
//-----------------------------------------------------------------------------
void timer::stop()
{
    // 現在日時取得
    gettimeofday( &(timer::m_stoped), NULL );
}

//-----------------------------------------------------------------------------
// 経過時間
//-----------------------------------------------------------------------------
double timer::elapsed()
{
    // 停止(一時)
    timer::stop();

    // 結果を返却
    return timer::elapsed(timer::m_start, timer::m_stoped);
}

//-----------------------------------------------------------------------------
// 経過時間(struct timeval)
//-----------------------------------------------------------------------------
double timer::elapsed(struct timeval old, struct timeval now)
{
    double seconds = (double)(now.tv_sec - old.tv_sec);
    double nanoseconds = (double)(now.tv_usec - old.tv_usec );
    return seconds + nanoseconds * 0.001 * 0.001;
}
